<!doctype html>
<html>
<head>
<title>CarShop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Titillium+Web:300" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<style>

* {
    margin: 0;
    padding: 0;
    border: 0;
    outline: 0;
    font-size: 100%;
    vertical-align: baseline;
    background: transparent;
    font-size: 1em;
    font-family: 'Titillium Web', sans-serif;
}

a {
    color: black;
    text-decoration:none;
}

#header {
    background-color: rgb(100,200,200);
    font-family: 'Titillium Web', sans-serif;
    text-align: center;
    color: white;
    margin: 0;
    width: 80vw;
    padding-left: 10vw;
    padding-right: 10vw;
}

#title {
    font-size: 3.5em;
    letter-spacing: 1em;
}

#subtitle {
    font-size: 2vw;
    letter-spacing: 0.5em;
}

#navbar {
    display: inline-block;
}

#navbar a {
    font-size: 2em;
    color: rgb(255,255,255);
}

#navbar a:hover {
    color: rgb(230,230,230);
}

#filterbar {
    display: inline-block;
    text-align: center;
    background-color: rgb(240, 240, 240);
    width: 100vw;
    padding-top: 10px;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

#filterbar p {
    display: inline-block;
    padding-right: 10px;
}

#content p {
    font-family: 'Titillium Web', sans-serif;
    text-align: center;
    font-size: 2em;
}

#content table {
    width: 80vw;
    margin-left: auto;
    margin-right: auto;
    table-layout: fixed;
    display: block;
}

#content td {
    padding: 15px;
    border: 1px solid rgb(230,230,230);
    border-collapse: collapse;
    display: inline-block;
    text-align: center;
}

#content td, img {
    width: 17.5vw;
}

@media screen and (max-width: 1060px) {
    #title {
        font-size: 1.5em;
    }

    #navbar a {
        font-size: 1em;
    }
}

@media screen and (max-width: 600px) {
    #title {
        font-size: 1em;
    }

    .subject .title {
        font-size: 1.5em;
    }

    #navbar a {
        font-size: 1em;
    }
}

</style>

<script>
    // function contains(a, obj) {
    //     var i = a.length;
    //     while (i--) {
    //        if (a[i] === obj) {
    //            return true;
    //        }
    //     }
    //     return false;
    // }

// $.getJSON("http://145.24.222.132:8080/filter/make/Lotus", function(data) {
//     // Get the element with id summary and set the inner text to the result.
//     // $('#summary').text(data.result);
//     console.log("Data: " + data);
//     $('#Content').append('<hr><p><b>JSON!</b></p>');
//     for(i = 0; i < data.data.length; i++) {
//         if(data.data[i].message) {
//             console.log(data.data[i]);
//             data.data[i].message = data.data[i].message.replace(/(\r\n|\n|\r)/gm, "<br />");
//             $('#Content').append('<hr><p>' + data.data[i].message + '</p>');
//         }
//     }
//     $('#Content').append('<hr>');
// });

</script>

<head>
<body>

<div id="header">
    <p id="title">CarShop</p>
    <div id="navbar">
        <a href="#">CARS -</a>
        <a href="#">MY PROFILE -</a>
        <a href="#">CONTACT -</a>
        <a href="#">ABOUT US</a>
    </div>
</div>
<hr>
<div id="filter">
    <div id="filterbar">
    <p>Filter Cars</p>
        <select class="selector" id="selectmake">
            <option value="" disabled="disabled" selected="selected">Brand</option>
            <option>Lotus</option>
            <option>Ford</option>
        </select>
        <select class="selector" id="selectmodel">
            <option value="" disabled="disabled" selected="selected">Model</option>
            <option>Elise</option>
            <option>GT</option>
        </select>
        <select class="selector" id="selectyear">
            <option value="" disabled="disabled" selected="selected">Year</option>
            <option>2012</option>
            <option>2016</option>
        </select>
    </div>
</div>
<hr>

<div id="content">
    <p>Over 7000 Cars For Sale<p>
</div>

</body>
</html>


<script>

    function uArray(array) {
        return array.filter(function(itm,i,array) {
            return i==array.indexOf(itm);
        });
    }

    function setFilters() {
        $('#filter').hide();
        $.get('http://145.24.222.132:8080/filter/Car/model/nn', function(data){
            var brandarray = [];
            var modelarray = [];
            var yeararray = [];

            brandarray.push('<option value="" disabled="disabled" selected="selected">Brand</option>');
            modelarray.push('<option value="" disabled="disabled" selected="selected">Model</option>');
            yeararray.push('<option value="" disabled="disabled" selected="selected">Year</option>');

            for (var i = data.length - 1; i >= 0; i--) {
                brandarray.push('<option value="">' + data[i].properties.make + '</option>');
                modelarray.push('<option value="">' + data[i].properties.model + '</option>');
                yeararray.push('<option value="">' + data[i].properties.year + '</option>');
            }

            brandarray = uArray(brandarray);
            modelarray = uArray(modelarray);
            yeararray = uArray(yeararray);

            $('#selectbrand').html(brandarray.join(''));
            $('#selectmodel').html(modelarray.join(''));
            $('#selectyear').html(yeararray.join(''));

            $('#filter').show();
        });
    }

    function setFilter(property) {
        $.get('http://145.24.222.132:8080/filter/Car?property1=' + property, function(data){
            var array = [];
            array.push('<option value="" disabled="disabled" selected="selected">' + property + '</option>');

            for (var i = data.length - 1; i >= 0; i--) {
                array.push('<option value="">' + data[i] + '</option>');
            }

            array = uArray(array);
            $('#select' + property).html(array.join(''));
        });
    }

    function setJSONTable(value) {
        var url = 'http://145.24.222.132:8080' + value;
        console.log(value);
        $.get(url, function(data){
            var table = $('<table>');

            var row = $('<tr>');
            for (var i = data.length - 1; i >= 0; i--) {
                var item = $('<td></td>');

                // item.append("<img src=\"" + data[i].properties.picture + "\">");
                item.append("Brand: " + data[i].properties.make);
                item.append("<br>Model: " + data[i].properties.model);
                item.append("<br>Year: " + data[i].properties.year);
                item.append("<br>&euro;" + data[i].properties.price);
                row.append(item);
            }

            row.append('</tr>');
            table.append(row);
            table.append('</table>');
            $('#content').html('');
            $('#content').append(table);
        });
    }

    function addListeners(value) {
        var property = false;
        $("#select" + value).hover(function () {
            if(!property) {
                setFilter(value);
                property = true;
            }
        });

        $("#select" + value).change(function () {
            if(value == 'make') {
                console.log("if");
                $('#selectmodel').prop('selectedIndex',0);
            } else if(value == 'model') {
                console.log("else if");
                $('#selectmake').prop('selectedIndex',0);
            }
            setJSONTable('/filter/Car?property1=' + value + '&value1=' + $('#select' + value + ' option:selected').text());
        });
    }


    addListeners('make');
    addListeners('model');
    addListeners('year');

    //Initial Setup
    setJSONTable('/filter/Car');

</script>